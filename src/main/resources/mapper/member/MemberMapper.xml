<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.crewstation.mapper.member.MemberMapper">
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into tbl_member (member_name, member_phone, member_email, member_social_url, member_birth, member_gender, member_mbti, member_password)
        values (#{memberName}, #{memberPhone}, #{memberEmail}, #{memberSocialUrl}, #{memberBirth}, #{memberGender}, #{memberMbti}, #{memberPassword})
    </insert>
    <select id="selectEmail">
        select count(*) > 0
        from tbl_member
        where member_email = #{memberEmail}
    </select>
<!--  내가 추가한 부분 -->
    <select id="selectMemberByMemberEmail">
        select *
        from tbl_member
        where member_email = #{memberEmail} and member_status = 'active'
    </select>

<!-- 게스트 관련 부분 -->
    <insert id="insertGuest" useGeneratedKeys="true" keyProperty="id">
        insert into tbl_member (member_name)
        values ('guest')
    </insert>
    <!--  내가 추가한 부분 -->
    <select id="selectForLogin">
        select id, member_name, member_email, member_social_url, member_gender, member_mbti, member_password, member_status, member_provider, social_img_url, member_social_email, member_description, member_role, created_datetime, updated_datetime, chemistry_score
        from tbl_member
        where member_email = #{memberEmail} and member_password = #{memberPassword} and member_status = 'active'
    </select>
<!--  social  -->
    <insert id="insertSns">
        insert into tbl_member (member_name, member_phone, member_social_url, member_gender, member_birth, member_mbti, member_provider, social_img_url, member_social_email)
        values (#{memberName}, #{memberPhone}, #{memberSocialUrl}, #{memberGender}, #{memberBirth}, #{memberMbti}, #{memberProvider}, #{socialImgUrl}, #{memberSocialEmail})
    </insert>

    <select id="selectMemberBySnsEmail">
        select id, member_name, member_phone, member_social_url, member_birth, member_gender, member_mbti, member_provider, social_img_url, member_social_email, member_description, chemistry_score
        from tbl_member
        where member_social_email = #{memberSocialEmail} and member_status = 'active'
    </select>
    <!-- 멤버 프로필 조회용 -->
    <select id="selectProfileById" parameterType="long"
            resultType="com.example.crewstation.dto.member.MemberProfileDTO">
        SELECT id   AS memberId,
               member_name AS memberName,
               social_img_url AS socialImgUrl
        FROM tbl_member
        WHERE id = #{memberId}

    </select>
</mapper>